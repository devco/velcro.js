!function(t){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?t(require("knockout"),module.exports||exports):"function"==typeof define&&define.amd?define(["knockout","exports"],t):t(ko,window.ku={})}(function(t,e){function n(t,e){return t?("object"==typeof t&&t.constructor&&(t=t.constructor),"function"==typeof t&&(t=""+t),t===e):!1}function i(t,e){if(t=t||[],"string"==typeof t&&(t=[t]),"number"==typeof t.length){for(var n=0;t.length>n;n++)if(e(n,t[n])===!1)return}else for(var i in t)if(e(i,t[i])===!1)return}function r(e){return t.computed({read:function(){return e},write:function(t){e.from(t)},owner:e})}function o(t,n){i(n,function(n,i){if(e.utils.isModel(i)||e.utils.isCollection(i))return t.relations[n]=i,void 0;if("function"==typeof i){var r,o;return e.isReader(n)?(r=e.fromReader(n),o="read"):e.isWriter(n)&&(r=e.fromWriter(n),o="write"),o?(t.computed[r]===void 0&&(t.computed[r]={}),t.computed[r][o]=i,void 0):(t.methods[n]=i,void 0)}t.properties[n]=i})}function s(t){t.observer=r(t),u(t),h(t),a(t),c(t)}function u(e){i(e.$self.computed,function(n,i){e[n]=t.computed({owner:e,deferEvaluation:!0,read:i.read,write:i.write})})}function h(t){i(t.$self.methods,function(e,n){t[e]=function(){return n.apply(t,arguments)}})}function a(e){i(e.$self.properties,function(n,i){e[n]="[object Array]"===Object.prototype.toString.call(i)?t.observableArray(i):t.observable(i)})}function c(t){i(t.$self.relations,function(e,n){var i=new n;t[e]=i.observer,i.$parent=t})}function f(t){return t.replace(/http(s)?\:\/\/[^\/]+/,"")}function d(t){window.addEventListener?window.addEventListener(t,v,!1):window["on"+t]=v}function p(t){document.createEvent?(event=document.createEvent("HTMLEvents"),event.initEvent(t,!0,!0),window.dispatchEvent(event)):window["on"+t](document.createEventObject())}function l(t,e){if(!e){var n=t.replace(/^#/,""),i=document.getElementById(n),r=window.pageXOffset?window.pageXOffset:document.body.scrollLeft,o=window.pageYOffset?window.pageYOffset:document.body.scrollTop,s=document.createElement("div");i&&(i.id=""),s.id=n||"_",s.style.position="absolute",s.style.width=0,s.style.height=0,s.style.left=r+"px",s.style.top=o+"px",s.style.padding=0,s.style.margin=0,document.body.appendChild(s),window.location.hash="#"+s.id,document.body.removeChild(s),i&&(i.id=n)}}function v(){for(var t=0;w.length>t;t++)w[t].dispatch()}if(t===void 0)throw"KnockoutJS is required. Download at https://github.com/SteveSanderson/knockout.";e.App=function(){this.attributePrefix="data-ku-",this.bindings=e.defaultBindings,this.context=null},e.App.prototype={run:function(t,e){e||(e=t,t=document),this.context=e,this.bindAll(t)},bindAll:function(t){return this.bindOne(t),this.bindDescendants(t),this},bindOne:function(t){var n=this;return i(t.attributes,function(i,r){var o=r.nodeName.substring(n.attributePrefix.length);"function"==typeof n.bindings[o]&&n.bindAttribute(t,o,e.utils.parseBinding(r.nodeValue,n.context))}),this},bindDescendants:function(t){var e=this;return i(t.childNodes,function(t,n){e.bindAll(n,e.context)}),this},bindAttribute:function(t,e,n){var r=this;return this.bindings[e].call(r,t,n),i(n,function(i,o){"function"==typeof o.subscribe&&o.subscribe(function(){r.bindAttribute(t,e,n)})}),this}},e.collection=function(t){var n=function(n){Array.prototype.push.apply(this,[]),this.observer=r(this),this.aggregate=function(t,e){var n=[];return e||(e=[t],t=""),this.each(function(r,o){var s=[];i(e,function(t,e){"function"==typeof o[e]&&s.push(o[e]())}),n.push(s.join(t))}),n},this.at=function(t){return this[t]===void 0?!1:this[t]},this.first=function(){return this.at(0)},this.last=function(){return this.at(this.length-1)},this.has=function(t){return this[t]!==void 0},this.remove=function(t){return t="number"==typeof t?t:this.index(t),this.has(t)&&(Array.prototype.splice.call(this,t,1),this.observer.notifySubscribers()),this},this.empty=function(){return Array.prototype.splice.call(this,0,this.length),this.observer.notifySubscribers(),this},this.prepend=function(t){return this.insert(0,t)},this.append=function(t){return this.insert(this.length,t)},this.insert=function(n,i){return i=e.utils.isModel(i)?i:new t(i),i.$parent=this.$parent,Array.prototype.splice.call(this,n,0,i),this.observer.notifySubscribers(),this},this.replace=function(n,i){return i=e.utils.isModel(i)?i:new t(i),i.$parent=this.$parent,Array.prototype.splice.call(this,n,1,i),this.observer.notifySubscribers(),this},this.index=function(t){var e=-1;return this.each(function(n,i){return i===t?(e=n,void 0):void 0}),e},this.from=function(t){var n=this;return e.utils.isCollection(t)&&(t=t.raw()),i(t,function(t,e){n.has(t)?n.replace(t,e):n.replace(t,e)}),this},this.raw=function(){var t=[];return this.each(function(e,n){t.push(n.raw())}),t},this.each=function(t){for(var e=0;this.length>e;e++)t.call(this,e,this[e]);return this},this.find=function(t,n,r){var o=new this.$self.Model.Collection;return o.$parent=this.$parent,e.utils.isModel(t)&&(t=t.raw()),"object"==typeof t&&(t=function(t){return function(){var e=this,n=!0;return i(t,function(t,i){return e[t]===void 0||e[t]()!==i?(n=!1,!1):void 0}),n}}(t)),this.each(function(e,i){if(n&&r){var s=n*r-n;if(e>s)return}return t.call(i,e)&&o.append(i),n&&o.length===n?!1:void 0}),o},this.findOne=function(t){return this.find(t,1).first()},this["export"]=this.raw,this["import"]=this.from,this.from(n)};return n.Model=t,n.prototype={$self:n},n},e.Context=function(t){this.data=t||{},this.parent=null},e.Context.prototype={get:function(t){return this.has(t)?this.data[t]:void 0},set:function(t,e){return this.data[t]=e,this},has:function(t){return this.data[t]!==void 0},remove:function(t){return this.has(t)&&delete this.data[t],this}},e.defaultBindings={context:function(t,e){this.context=e.context()},include:function(t,n){var i=n.view||new e.View;i.target=t,i.render(n.path,n.context)},routable:function(t,n){var i=n.router;i||e.utils.throwForElement(t,'Cannot bind router "'+value+'" to the main view because it does not exist.'),!i instanceof e.Router&&e.utils.throwForElement(t,'Cannot bind router "'+value+'" to the main view because it is not an instanceof "ku.Router".'),i.view.target=t,i.bind()},text:function(t,e){t.innerText=e.text()}},e.Event=function(){return this.stack=[],this},e.Event.prototype={bind:function(t){return this.stack.push(t),this},unbind:function(t){if(t){var e=[];for(var n in this.stack)this.stack[n]!==t&&e.push(this.stack[n]);this.stack=e}else this.stack=[];return this},trigger:function(t){for(var e in this.stack)if(this.stack[e].apply(this,t)===!1)return!1}},e.Events=function(){return this.events={},this},e.Events.prototype={on:function(t,n){return this.events[t]===void 0&&(this.events[t]=new e.Event),this.events[t].bind(n),this},off:function(t,e){return t?(this.events[t]!==void 0&&this.events[t].unbind(e),this):(this.events={},this)},trigger:function(t,e){return this.events[t]!==void 0&&this.events[t].trigger(e)===!1?!1:void 0}},e.Http=function(){return this.events=new e.Events,this},e.Http.prototype={prefix:"",suffix:"",headers:{},parsers:{"application/json":function(t){try{return JSON.parse(t)}catch(e){throw'Error parsing response "'+t+'" with message "'+e+'".'}}},"delete":function(t,e,n){return this.request(t,e||{},"delete",n||e)},get:function(t,e,n){return this.request(t,e||{},"get",n||e)},head:function(t,e,n){return this.request(t,e||{},"head",n||e)},options:function(t,e,n){return this.request(t,e||{},"options",n||e)},patch:function(t,e,n){return this.request(t,e,"patch",n)},post:function(t,e,n){return this.request(t,e,"post",n)},put:function(t,e,n){return this.request(t,e,"put",n)},request:function(t,n,i,r){var o=this,s=this.createRequestObject();s.open(i.toUpperCase(),this.prefix+t+this.suffix,!0);for(var u in this.headers)s.setRequestHeader(u,this.headers[u]);return s.onreadystatechange=function(){if(4===s.readyState){if(200!==s.status&&304!==s.status)return o.events.trigger("error",[s]),o.events.trigger("stop",[s]),void 0;var t=s.responseText,e=s.getAllResponseHeaders();"string"==typeof e["Content-Type"]&&"function"==typeof o.parsers[e["Content-Type"]]?t=o.parsers[e["Content-Type"]](t):"string"==typeof o.headers.Accept&&"function"==typeof o.parsers[o.headers.Accept]&&(t=o.parsers[o.headers.Accept](t)),"function"==typeof r&&r(t,s),o.events.trigger("success",[t,s]),o.events.trigger("stop",[s])}},4!==s.readyState?(e.utils.isModel(n)&&(n=n.raw()),"object"==typeof n&&(n=this.serialize(n)),n&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.events.trigger("start",[s]),s.send(n),this):void 0},serialize:function(t,e){var n=[];for(var i in t){var r=e?e+"["+i+"]":i,o=t[i];n.push("object"==typeof o?this.serialize(o,r):encodeURIComponent(r)+"="+encodeURIComponent(o))}return n.join("&")},createRequestObject:function(){var t=!1;factories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var e=0;factories.length>e;e++)try{t=factories[e]()}catch(n){continue}if(!t)throw"An XMLHttpRequest could not be generated.";return t}},e.model=function(t){var n=function(t){var r=this;this.clone=function(){var t=new n(this.raw());return t.$parent=this.$parent,t},this.from=function(t){return e.utils.isModel(t)&&(t=t.raw()),i(t,function(t,e){"function"==typeof r[t]&&r[t](e)}),this.observer.notifySubscribers(),this},this.raw=function(){var t={};return i(r.$self.properties,function(e){t[e]=r[e]()}),i(r.$self.computed,function(e){t[e]=r[e]()}),i(r.$self.relations,function(e){t[e]=r[e]().raw()}),t},this.reset=function(){return i(r.$self.properties,function(t,e){r[t](e)}),this},this["export"]=this.raw,this["import"]=this.from,s(this),this.from(t),"function"==typeof this.init&&this.init()};return n.Collection=e.collection(n),n.computed={},n.methods={},n.properties={},n.relations={},n.prototype.$self=n,n.extend=function(t){return t=e.utils.isModel(t)?t:e.model(t),i(n.computed,function(e,n){t.computed[e]===void 0&&(t.computed[e]=n)}),i(n.methods,function(e,n){t.methods[e]===void 0&&(t.methods[e]=n)}),i(n.properties,function(e,n){t.properties[e]===void 0&&(t.properties[e]=n)}),i(n.relations,function(e,n){t.relations[e]===void 0&&(t.relations[e]=n)}),t},n.inherit=function(t){return t.extend(n)},o(n,t),n};var w=[];e.Router=function(){return this.events=new e.Events,this.routes={},this.state=new e.State,this.view=new e.View,this},e.Router.prototype={route:!1,bind:function(){return w.push(this),"onpopstate"in window&&this.state.enabled&&(!this.state.enabled||window.location.hash)||this.dispatch(),this},unbind:function(){for(var t=0;w.length>t;t++)this===w[t]&&delete w[t];return this},set:function(t,n){return"function"==typeof n&&(n={match:RegExp("^"+t+"$"),format:t,controller:n}),n.view||(n.view=t),this.routes[t]=n instanceof e.Route?n:new e.Route(n),this},get:function(t){if(this.has(t))return this.routes[t];throw'Route "'+t+'" does not exist.'},has:function(t){return this.routes[t]!==void 0},remove:function(t){return this.has(t)&&delete this.routes[t],this},dispatch:function(t){t===void 0&&(t=this.state.get());for(var n in this.routes){var i=this.routes[n],r=i.query(t);if("number"==typeof r.length){if(this.events.trigger("exit",[this])===!1)return this;if(this.route&&this.events.trigger("exit."+n,[this,this.route])===!1)return this;if(this.events.trigger("enter",[this])===!1)return this;if(this.events.trigger("enter."+n,[this,i])===!1)return this;var o=i.controller.apply(i.controller,r);return o&&o.constructor===Object&&(o=new(e.model(o))),o!==!1&&this.view.render(i.view,o),this.route=i,this.state.previous=t,this}}return this.route=!1,this},go:function(t,e,n){return this.state.push(this.get(t).generate(e),n),this},generate:function(t,e){return this.get(t).generate(e)}},e.Route=function(t){for(var e in t)this[e]=t[e];return this},e.Route.prototype={match:/.*/,format:"",view:!1,controller:function(){},query:function(t){var e=t.match(this.match);return null===e?!1:(e.shift(),e)},generate:function(t){var e=this.format;for(var n in t)e=e.replace(RegExp("\\:"+n,"g"),t[n]);return e}};var g,b=window.location.hash,m=!1;e.State=function(){return this.states={},e.State.start(),this},e.State.interval=500,e.State.start=function(){if(m)return e.State;var t="onhashchange"in window&&/MSIE\s(6|7)/.test(navigator.userAgent);return"onpopstate"in window?d("popstate"):t?(d("hashchange"),g=setInterval(function(){b!==window.location.hash&&(b=window.location.hash,p("hashchange"))},e.State.interval)):d("hashchange"),m=!0,e.State},e.State.stop=function(){g&&clearInterval(g);var t="onpopstate"in window?"popstate":"hashchange";return window.removeEventListener?window.removeEventListener(t,v):window[t]&&delete window[t],m=!1,State},e.State.prototype={previous:!1,enabled:!1,scroll:!1,get:function(){return this.enabled&&window.history.pushState?f(window.location.href):window.location.hash.substring(1)},push:function(t,e,n){return this.enabled&&window.history.pushState?(window.history.pushState(e,n,t||"."),v()):l(t,this.scroll),this.states[t]=e,this},data:function(t){return t=t||this.get(),this.states[t]===void 0?null:this.states[t]}},e.utils={parseBinding:function(t,e){var n="";for(var i in e||{})"import"!==i&&"export"!==i&&""!==i&&(n+="var "+i+"=__context['"+i+"'];");n+="return {"+t+"};";try{return Function("__context",n)(e)}catch(r){throw'Error parsing binding "'+t+'" with message: "'+r+'"'}},outerHtml:function(t){var e=document.createElement("div");return e.appendChild(t),e.innerHTML},throwForElement:function(t,n){throw n+"\n"+e.outerHtml(t)},isReader:function(t){return 0===t.indexOf("read")},isWriter:function(t){return 0===t.indexOf("write")},toReader:function(t){return"read"+t.substring(0,1).toUpperCase()+t.substring(1)},toWriter:function(t){return"write"+t.substring(0,1).toUpperCase()+t.substring(1)},fromReader:function(t){return t.substring(4,5).toLowerCase()+t.substring(5)},fromWriter:function(t){return t.substring(5,6).toLowerCase()+t.substring(6)},isModel:function(t){return n(t,""+e.model())},isCollection:function(t){return n(t,""+e.collection())}},e.View=function(){return this.cache={},this.http=new e.Http,this.http.prefix="views/",this.http.suffix=".html",this.http.accept="text/html",this},e.View.prototype={http:!1,target:null,idPrefix:"ku-view-",idSuffix:"",idSeparator:"-",render:function(t,e){var n=this,i=this.idPrefix+t.replace(/\//g,this.idSeparator)+this.idSuffix;return this.cache[t]?this.renderer(this.cache[t],e):document.getElementById(i)?this.renderer(this.cache[t]=document.getElementById(i).innerHTML,e):this.http&&this.http.get(t,function(i){n.renderer(n.cache[t]=i,e)}),this},renderer:function(n,i){var r=this.target;if(!r)throw"Cannot render view because no target was specified.";"string"==typeof r?r=document.getElementById(r):"function"==typeof r&&(r=r()),r.innerHTML=n,e.bindDescendants(r),t.applyBindings(i,r)}}});