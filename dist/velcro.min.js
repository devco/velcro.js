!function(t){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?t(module.exports||exports):"function"==typeof define&&define.amd?define(["exports"],t):t(window.Velcro={})}(function(t){function e(){for(var t=!1,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;e.length>n;n++)try{t=e[n]()}catch(i){continue}if(!t)throw"An XMLHttpRequest could not be generated.";return t}function n(t){return t.replace(/http(s)?\:\/\/[^\/]+/,"")}function i(t){window.addEventListener?window.addEventListener(t,s,!1):window["on"+t]=s}function o(t){document.createEvent?(event=document.createEvent("HTMLEvents"),event.initEvent(t,!0,!0),window.dispatchEvent(event)):window["on"+t](document.createEventObject())}function r(t,e){if(!e){var n=t.replace(/^#/,""),i=document.getElementById(n),o=window.pageXOffset?window.pageXOffset:document.body.scrollLeft,r=window.pageYOffset?window.pageYOffset:document.body.scrollTop,s=document.createElement("div");i&&(i.id=""),s.id=n||"_",s.style.position="absolute",s.style.width=0,s.style.height=0,s.style.left=o+"px",s.style.top=r+"px",s.style.padding=0,s.style.margin=0,document.body.appendChild(s),window.location.hash="#"+s.id,document.body.removeChild(s),i&&(i.id=n)}}function s(){for(var t=0;u.length>t;t++)u[t].dispatch()}t.utils={addEvent:function(t,e,n){t.attachEvent?t.attachEvent("on"+e,function(){n.call(t)}):t.addEventListener&&t.addEventListener(e,n,!1)},createElement:function(t){var e=document.createElement("div");e.innerHTML=t;var n=e.childNodes[0];return e.removeChild(n),n},destroyElement:function(t){t.parentNode.removeChild(t),t.innerHTML="",delete t.attributes,delete t.childNodes},elementIndex:function(t){for(var e=0;t.parentNode.childNodes>e;e++)if(t===t.parentNode.childNodes[e])return e;return!1},html:function(t){var e=document.createElement("div");return e.appendChild(t.cloneNode(!0)),e.innerHTML},each:function(t,e){if(t=t||[],"string"==typeof t&&(t=[t]),"number"==typeof t.length){for(var n=0;t.length>n;n++)if(e(n,t[n])===!1)return}else for(var i in t)if(e(i,t[i])===!1)return},fnCompare:function(t,e){return t?("object"==typeof t&&t.constructor&&(t=t.constructor),"function"==typeof t&&(t=""+t),t===e):!1},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isClass:function(e){return"function"==typeof e&&"function"==typeof e.extend&&e.extend===t.Class.extend},isInstance:function(t){return t&&"function"==typeof t.constructor},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isValue:function(e){return"function"==typeof e&&""+e==""+t.value()},merge:function(){for(var e={},n=0;arguments.length>n;n++){var i=arguments[n];if(t.utils.isObject(i))for(var o in i){var r=i[o];e[o]=t.utils.isObject(r)?e[o]===void 0||t.utils.isInstance(r)?r:t.utils.merge(e[o],r):r}}return e},parseBinding:function(t,e){var n="";for(var i in e||{})"import"!==i&&"export"!==i&&""!==i&&(n+="var "+i+"=__context['"+i+"'];");n+="return {"+t+"};";try{return Function("__context",n)(e)}catch(o){throw'Error parsing binding "'+t+'" with message: "'+o+'"'}},parseJson:function(t){try{return JSON.parse(t)}catch(e){throw'Error parsing response "'+response+'" with message "'+e+'".'}},extract:function(e){var n={};return t.utils.each(e,function(e,i){n[e]=t.utils.isValue(i)?i():i}),n},throwForElement:function(e,n){throw n+"\n"+t.html(e)}},function(){function e(){return function(){s||"function"!=typeof this.init||this.init.apply(this,arguments)}}function n(t,e){s=!0,e.prototype=new t,s=!1}function i(e,n,i,r){n.extend=i,n.isSubClassOf=function(e){var i=a[u.indexOf(n)];return i===t.Class||i===e||i.isSubClassOf(e)},n.prototype.$self=n;for(var s in r)n.prototype[s]="function"==typeof n.prototype[s]?o(e.prototype,r,s):r[s];n.prototype.constructor=n}function o(t,e,n){return function(e,n){return function(){var i=this.$super;this.$super=t[e];var o=n.apply(this,arguments);return this.$super=i,o}}(n,e[n])}function r(t,e){u.push(e),a[u.indexOf(e)]=t}t.Class=function(){};var s=!1,u=[],a={};t.Class.extend=function(t){var o=e();return r(this,o),n(this,o),i(this,o,arguments.callee,t),o}}(),function(){t.Binding=t.Class.extend({init:function(t,e,n){"function"==typeof this.update&&this.update(t,e,n)}})}(),t.defaultBindings={click:t.Binding.extend({init:function(e,n,i){t.utils.addEvent(n,"click",function(t){i.callback(t)})}}),context:t.Binding.extend({update:function(e,n,i){i.context||t.utils.throwForElement(n,"A context option must be specified."),e.context(i.context)}}),each:t.Binding.extend({app:null,clones:null,container:null,html:null,key:"$key",value:"$value",init:function(e,n,i){this.app=e,this.clones=[],this.container=n.parentNode,this.html=t.utils.html(this.clean(n)),t.utils.destroyElement(n),i.key&&(this.key=i.key),i.value&&(this.value=i.value),this.$super(e,n,i)},update:function(e,n,i){function o(e,n){var i=t.utils.isObject(n)?n:{};i[r.key]=e,i[r.value]=n;var o=t.utils.createElement(r.html);r.app.bind(o,i),r.clones.push(o),r.container.appendChild(o),delete i[r.key],delete i[r.value]}var r=this;this.reset(),i.items instanceof t.Model?i.items.each(function(t,e){o(t,e())}):i.items instanceof t.Collection?i.items.each(o):t.utils.each(i.items,o)},reset:function(){return t.utils.each(this.clones,function(e,n){t.utils.destroyElement(n)}),this.clones=[],this.container.innerHTML="",this},clean:function(t){return t.removeAttribute(this.app.options.attributePrefix+"each"),t}}),"if":t.Binding.extend({container:null,html:null,index:null,init:function(e,n,i){this.container=n.parentNode,this.element=n,this.index=t.utils.elementIndex(n),i.test||this.container.removeChild(this.element)},update:function(t,e,n){n.test?this.container.childNodes[this.index]?this.container.insertBefore(this.element,this.container.childNodes[this.index]):this.container.appendChild(this.element):this.element.parentNode&&this.container.removeChild(this.element)}}),include:t.Binding.extend({update:function(e,n,i){i=t.utils.merge({path:"",context:!1,callback:function(){},view:{}},i);var o=new t.View(i.view);o.options.target=n,"function"==typeof i.context&&(i.context=i.context()),i.path||t.utils.throwForElement(n,"A path option must be specified."),o.render(i.path,function(){e.bindDescendants(n,i.context),i.callback()})}}),routable:t.Binding.extend({update:function(e,n,i){var o=i.router;o||t.utils.throwForElement(n,'Cannot bind router "'+value+'" because it does not exist.'),!o instanceof t.Router&&t.utils.throwForElement(n,'Cannot bind router "'+value+'" because it is not an instanceof "Velcro.Router".'),o.view.options.target=n,o.bind()}}),text:t.Binding.extend({update:function(t,e,n){e.innerText=n.text}})},t.Event=function(){return this.stack=[],this},t.Event.prototype={bind:function(t){return this.stack.push(t),this},unbind:function(t){if(t){var e=[];for(var n in this.stack)this.stack[n]!==t&&e.push(this.stack[n]);this.stack=e}else this.stack=[];return this},once:function(t){var e=this;return this.bind(function(){t.call(t,arguments),e.unbind(t)})},trigger:function(){return this.triggerArgs(Array.prototype.slice.call(arguments,1))},triggerArgs:function(t){for(var e in this.stack)if(this.stack[e].apply(this.stack[e],t)===!1)return!1;return this}},t.Http=function(e){return this.before=new t.Event,this.after=new t.Event,this.success=new t.Event,this.error=new t.Event,this.options=t.utils.merge({async:!0,headers:{},parsers:{"application/json":t.utils.parseJson},prefix:"",suffix:""},e),this},t.Http.prototype={"delete":function(e){return this.request(t.utils.merge(e,{type:"delete"}))},get:function(e){return this.request(t.utils.merge(e,{type:"get"}))},head:function(e){return this.request(t.utils.merge(e,{type:"head"}))},options:function(e){return this.request(t.utils.merge(e,{type:"options"}))},patch:function(e){return this.request(t.utils.merge(e,{type:"patch"}))},post:function(e){return this.request(t.utils.merge(e,{type:"post"}))},put:function(e){return this.request(t.utils.merge(e,{type:"put"}))},request:function(n){var i=this,o=e();n=t.utils.merge({type:"GET",data:{},success:function(){},error:function(){},before:function(){},after:function(){}},n),n.type=n.type.toUpperCase(),n.data instanceof t.Model&&(n.data=n.data.raw()),t.utils.isObject(n.data)&&(n.data=this.serialize(n.data)),n.data&&("GET"===n.type?n.url+="?"+n.data:o.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),o.open(n.type,this.options.prefix+n.url+this.options.suffix,this.options.async);for(var r in this.options.headers)o.setRequestHeader(r,this.options.headers[r]);return o.onreadystatechange=function(){if(4===o.readyState){if(200!==o.status&&304!==o.status)return n.error.call(n.error,o),i.error.trigger(o),n.after.call(n.after,o),i.after.trigger(o),void 0;var t=o.responseText,e=o.getAllResponseHeaders();"string"==typeof e["Content-Type"]&&"function"==typeof i.options.parsers[e["Content-Type"]]?t=i.options.parsers[e["Content-Type"]](t):"string"==typeof i.options.headers.Accept&&"function"==typeof i.options.parsers[i.options.headers.Accept]&&(t=i.options.parsers[i.options.headers.Accept](t)),n.success.call(n.success,t),i.success.trigger(t),n.after.call(n.after,o),i.after.trigger(o)}},n.before.call(n.before,o),this.before.trigger(o),"GET"===n.type?o.send():o.send(n.data),this},serialize:function(t,e){var n=[];for(var i in t){var o=e?e+"["+i+"]":i,r=t[i];n.push("object"==typeof r?this.serialize(r,o):encodeURIComponent(o)+"="+encodeURIComponent(r))}return n.join("&")}};var u=[];t.Router=function(e){return this.options=t.utils.merge({app:{},state:{},view:{}},e),this.enter=new t.Event,this.exit=new t.Event,this.render=new t.Event,this.params={},this.route=!1,this.routes={},this.app=new t.App(this.options.app),this.state=new t.State(this.options.state),this.view=new t.View(this.options.view),this},t.Router.prototype={handler:function(t){t()},renderer:function(e,n){var i=this,o=e.options.controller.apply(e.options.controller,n);!o instanceof t.Model&&(o=new(t.model(o))),this.view.render(e.options.view,function(t){i.app.bindDescendants(t.options.target,o),i.render.trigger(i,e,n)})},bind:function(){return this.unbind(),u.push(this),"onpopstate"in window&&this.state.enabled&&(!this.state.enabled||window.location.hash)||this.dispatch(),this},unbind:function(){for(var t=0;u.length>t;t++)this===u[t]&&delete u[t];return this},set:function(e,n){return"function"==typeof n&&(n={match:RegExp("^"+e+"$"),format:e,controller:n}),n.view||(n.view=e),this.routes[e]=n instanceof t.Route?n:new t.Route(n),this},get:function(t){if(this.has(t))return this.routes[t];throw'Route "'+t+'" does not exist.'},has:function(t){return this.routes[t]!==void 0},remove:function(t){return this.has(t)&&delete this.routes[t],this},dispatch:function(t){var e=this;t===void 0&&(t=this.state.get());var n=function(){e.renderer(o)};for(var i in this.routes){var o=this.routes[i],r=o.query(t);"number"==typeof r.length&&(this.route&&this.exit.trigger(this,this.state.previous,this.route,this.params),this.enter.trigger(this,t,o,r),this.params=r,this.route=o,this.state.previous=t,this.handler(n))}return this},go:function(t,e,n){return this.state.push(this.get(t).generate(e),n),this},generate:function(t,e){return this.get(t).generate(e)}},t.Route=function(e){return this.options=t.utils.merge({controller:function(){},format:"",match:/.*/,view:!1},e),this},t.Route.prototype={query:function(t){var e=t.match(this.options.match);return null===e?!1:(e.shift(),e)},generate:function(t){var e=this.options.format;for(var n in t)e=e.replace(RegExp("\\:"+n,"g"),t[n]);return e}};var a,c=window.location.hash,h=!1;t.State=function(){return this.options=t.utils.merge({scroll:!1}),this.states={},t.State.start(),this},t.State.interval=500,t.State.start=function(){if(h)return t.State;var e="onhashchange"in window&&/MSIE\s(6|7)/.test(navigator.userAgent);return"onpopstate"in window?i("popstate"):e?(i("hashchange"),a=setInterval(function(){c!==window.location.hash&&(c=window.location.hash,o("hashchange"))},t.State.interval)):i("hashchange"),h=!0,t.State},t.State.stop=function(){a&&clearInterval(a);var t="onpopstate"in window?"popstate":"hashchange";return window.removeEventListener?window.removeEventListener(t,s):window[t]&&delete window[t],h=!1,State},t.State.prototype={previous:!1,enabled:!1,get:function(){return this.enabled&&window.history.pushState?n(window.location.href):window.location.hash.substring(1)},push:function(t,e,n){return this.enabled&&window.history.pushState?(window.history.pushState(e,n,t||"."),s()):r(t,this.options.scroll),this.states[t]=e,this},data:function(t){return t=t||this.get(),this.states[t]===void 0?null:this.states[t]}},t.View=function(e){return this.cache={},this.options=t.utils.merge({idPrefix:"Velcro-view-",idSuffix:"",idSeparator:"-",target:!1,http:{prefix:"views/",suffix:".html",headers:{Accept:"text/html"}}},e),this.http=new t.Http(this.options.http),this},t.View.prototype={render:function(t,e){var n=this,i=this.options.idPrefix+t.replace(/\//g,this.options.idSeparator)+this.options.idSuffix,o=function(){"function"==typeof e&&e.call(e,n,t)};return this.cache[t]?(this.renderer(this.cache[t]),o()):document.getElementById(i)?(this.renderer(this.cache[t]=document.getElementById(i).innerHTML),o()):this.http&&this.http.get({url:t,success:function(e){n.renderer(n.cache[t]=e),o()}}),this},renderer:function(t){var e=this.options.target;if(!e)throw"Cannot render view because no target was specified.";"string"==typeof e?e=document.getElementById(e):"function"==typeof e&&(e=e()),e.innerHTML=t}},t.App=function(e){this.options=t.utils.merge({attributePrefix:"data-vc-",bindings:t.defaultBindings},e),this.contexts=[]},t.App.prototype={bind:function(t,e){return 1===arguments.length&&(e=t,t=document),this.context(e),this.bindOne(t),this.bindDescendants(t),this.restoreContext(),this},bindDescendants:function(e,n){var i=this;return 1===arguments.length&&(n=this.context()),t.utils.each(e.childNodes,function(t,e){i.bind(e,n)}),this},bindOne:function(e){var n=this;return t.utils.each(e.attributes,function(t,i){if(void 0!==e.attributes[t]){var o=i.nodeName.substring(n.options.attributePrefix.length);"function"==typeof n.options.bindings[o]&&n.bindAttribute(e,o,i.nodeValue)}}),this},bindAttribute:function(e,n,i){function o(){return t.utils.parseBinding(i,u)}function r(){c.update(s,e,t.utils.extract(o()))}var s=this,u=this.context(),a=o(),c=new this.options.bindings[n](this,e,t.utils.extract(a));if("function"==typeof c.update)for(var h in a)t.utils.isValue(a[h])?a[h].subscribe(r):(a[h]instanceof t.Model||a[h]instanceof t.Collection)&&a[h]._observer.subscribe(r);return this},context:function(t){return"object"==typeof t?(this.contexts.length&&(t.$parent=this.contexts[this.contexts.length-1],t.$root=this.contexts[0]),this.contexts.push(t),this):this.contexts.length?this.contexts[this.contexts.length-1]:!1},restoreContext:function(){return this.contexts.pop(),this}},t.value=function(e){function n(t){return 0===arguments.length?e.get.call(e.bind):(e.set.call(e.bind,t),n.publish(),e.bind)}var i=[],o=null;return t.utils.isObject(e)||(e={defaultValue:e}),e=t.utils.merge({defaultValue:null,bind:n,get:function(){return o},set:function(t){o=t}},e),o=e.defaultValue,n.subscribe=function(t){return i.push(t),e.bind},n.unsubscribe=function(t){for(var n=0;i.length>n;n++)if(t===subscriber)return i.splice(index,1),void 0;return e.bind},n.publish=function(){for(var t=e.get.call(e.bind),n=0;i.length>n;n++)i[n](t);return e.bind},n},function(){function e(t){t.$self.definition||n(t)}function n(t){i(t),o(t),r(t)}function i(t){t.$self.definition={relations:{},properties:{},computed:{},methods:{}}}function o(e){e.$self.Collection=t.Collection.extend({init:function(t){this.$super(e.$self,t)}})}function r(e){for(var n in e)if(void 0===t.Model.prototype[n]){var i=e[n];if(t.utils.isClass(i)&&(i.isSubClassOf(t.Model)||i.isSubClassOf(t.Collection)))e.$self.definition.relations[n]=i;else if("function"!=typeof i)e.$self.definition.properties[n]=i;else{var o,r;0===n.indexOf("get")?(o=n.substring(3,4).toLowerCase()+n.substring(4),r="get"):0===n.indexOf("set")&&(o=n.substring(3,4).toLowerCase()+n.substring(4),r="set"),r?(e.$self.definition.computed[o]===void 0&&(e.$self.definition.computed[o]={}),e.$self.definition.computed[o][r]=i):e.$self.definition.methods[n]=i}}}function s(t){u(t),a(t),c(t),h(t),f(t)}function u(e){e._observer=t.value({bind:e,get:function(){return this},set:function(t){this.from(t)}})}function a(t){for(var e in t.$self.definition.relations){var n=new t.$self.definition.relations[e];n._parent=t,t[e]=n._observer}}function c(e){for(var n in e.$self.definition.properties)e[n]=t.value({bind:e,defaultValue:e.$self.definition.properties[n]})}function h(e){for(var n in e.$self.definition.computed)e[n]=t.value({bind:e,get:e.$self.definition.computed[n].get?e.$self.definition.computed[n].get:l("getter",n),set:e.$self.definition.computed[n].set?e.$self.definition.computed[n].set:l("setter",n)})}function f(t){for(var e in t.$self.definition.methods)t[e]=function(){t.$self.definition.methods[e].apply(t,Array.prototype.slice.call(arguments,1))}}function l(t,e){return function(){throw"No "+t+' defined for computed property "'+e+'".'}}t.Model=t.Class.extend({_observer:null,_parent:null,init:function(t){e(this),s(this),this.from(t)},parent:function(){return this._parent},clone:function(){return new this.$self(this.to())},each:function(t){var e=this.$self.definition;for(var n in e.relations)t(n,this[n]);for(var i in e.properties)t(i,this[i]);for(var o in e.computed)t(o,this[o]);return this},from:function(e){return e?(e instanceof t.Model&&(e=e.to()),this.each(function(t,n){e[t]!==void 0&&n(e[t])}),this._observer.publish(),this):this},to:function(){var e={};return this.each(function(n,i){e[n]=i(),(e[n]instanceof t.Model||e[n]instanceof t.Collection)&&(e[n]=e[n].to())}),e}})}(),function(){t.Collection=t.Class.extend({_observer:null,_parent:null,_model:null,init:function(e,n){Array.prototype.push.apply(this,[]),this._observer=t.value({bind:this,get:function(){return this},set:function(t){this.from(t)}}),this._model=e,this.from(n)},aggregate:function(e,n){var i=[];return n||(n=[e],e=""),this.each(function(o,r){var s=[];t.utils.each(n,function(t,e){"function"==typeof r[e]&&s.push(r[e]())}),i.push(s.join(e))}),i},at:function(t){return this[t]===void 0?!1:this[t]},first:function(){return this.at(0)},last:function(){return this.at(this.length-1)},has:function(t){return this[t]!==void 0},remove:function(t){return t="number"==typeof t?t:this.index(t),this.has(t)&&(Array.prototype.splice.call(this,t,1),this._observer.publish()),this},empty:function(){return Array.prototype.splice.call(this,0,this.length),this._observer.publish(),this},prepend:function(t){return this.insert(0,t)},append:function(t){return this.insert(this.length,t)},insert:function(e,n){return n=n instanceof t.Model?n:new this._model(n),n._parent=this._parent,Array.prototype.splice.call(this,e,0,n),this._observer.publish(),this},replace:function(e,n){return n=n instanceof t.Model?n:new this._model(n),n._parent=this._parent,Array.prototype.splice.call(this,e,1,n),this._observer.publish(),this},index:function(t){var e=-1;return this.each(function(n,i){return i===t?(e=n,void 0):void 0}),e},from:function(e){var n=this;return e instanceof t.Collection&&(e=e.to()),t.utils.each(e,function(t,e){n.has(t)?n.replace(t,e):n.replace(t,e)}),this},to:function(){var t=[];return this.each(function(e,n){t.push(n.to())}),t},each:function(t){for(var e=0;this.length>e;e++)t(e,this[e]);return this},find:function(e,n,i){var o=new t.Collection(this._model);return o._parent=this._parent,e instanceof t.Model&&(e=e.to()),"object"==typeof e&&(e=function(e){return function(){var n=this,i=!0;return t.utils.each(e,function(t,e){return n[t]===void 0||n[t]()!==e?(i=!1,!1):void 0}),i}}(e)),this.each(function(t,r){if(n&&i){var s=n*i-n;if(t>s)return}return e.call(r,t)&&o.append(r),n&&o.length===n?!1:void 0}),o},findOne:function(t){return this.find(t,1).first()}}),t.Collection.make=function(t){return this.extend({init:function(e){this.$super(t,e)}})}}()});